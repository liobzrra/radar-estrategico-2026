<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Radar 4.0 | Agente de Intelig√™ncia Ativo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 800: '#1e293b', 900: '#0f172a' },
                        aero: { primary: '#0284c7', dark: '#0c4a6e', surface: '#f0f9ff' },
                        mil: { primary: '#4b5320', accent: '#6b705c' },
                        status: { error: '#ef4444', warning: '#f59e0b', success: '#10b981' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
                }
            }
        }
    </script>

    <style>
        :root { scroll-behavior: smooth; }
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .chart-wrapper { position: relative; width: 100%; height: 320px; }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(226, 232, 240, 0.8); }
        .premium-card { transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1); border: 1px solid #e2e8f0; background: #ffffff; position: relative; }
        .premium-card:hover { transform: translateY(-8px); box-shadow: 0 30px 60px -15px rgba(15, 23, 42, 0.1); border-color: #0284c7; }
        .sync-rotate { animation: rotate 2s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        #newsModal .modal-content { max-height: 90vh; width: 95vw; max-width: 1200px; border-radius: 3rem; }
        .reject-btn { opacity: 0; transform: translateX(5px); transition: all 0.3s ease; }
        .premium-card:hover .reject-btn { opacity: 1; transform: translateX(0); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 20px; }
    </style>
</head>
<body class="antialiased text-slate-900">

    <header class="glass-header sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-24 flex justify-between items-center">
            <div class="flex items-center gap-6">
                <div class="w-14 h-14 bg-slate-900 rounded-[1.25rem] flex items-center justify-center shadow-2xl">
                    <span class="text-3xl">üß†</span>
                </div>
                <div>
                    <h1 class="text-2xl font-black tracking-tighter uppercase leading-none">Neural Radar</h1>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="bg-status-success text-white text-[8px] font-black px-1.5 py-0.5 rounded tracking-widest uppercase">Motor Ativo</span>
                        <p class="text-[9px] font-mono text-slate-400 tracking-[0.2em] uppercase text-left">Setor Aeroespacial & Defesa</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <button id="syncBtn" class="flex items-center gap-3 bg-slate-900 text-white px-6 py-3.5 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-aero-primary transition-all shadow-xl disabled:opacity-50">
                    <span id="syncIcon" class="text-lg">üîÑ</span>
                    <span id="syncText">Sincronizar Agente</span>
                </button>

                <div class="hidden lg:flex flex-col items-end border-l border-slate-200 pl-8 ml-4">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none mb-1">Status</span>
                    <span id="lastUpdate" class="text-[11px] font-black text-status-success uppercase tracking-tighter italic">Consolidado</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-12">
        <!-- AI Overlay Status -->
        <div id="aiOverlay" class="hidden mb-12 p-8 bg-aero-primary/5 rounded-[3rem] border border-aero-primary/20 animate-fade">
            <div class="flex items-center gap-8">
                <div class="w-20 h-20 bg-white rounded-3xl flex items-center justify-center shadow-2xl relative overflow-hidden">
                    <span class="text-4xl sync-rotate z-10">üåÄ</span>
                </div>
                <div>
                    <h3 class="text-xl font-black text-slate-900 uppercase tracking-tight text-left">Agente Neural Reconfigurando</h3>
                    <p class="text-sm text-slate-500 font-medium italic text-left">Executando busca profunda (Google Search) em fontes oficiais de Janeiro/2026. Refinando base de dados...</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 mb-16">
            <div class="bg-white p-10 rounded-[3.5rem] border border-slate-100 shadow-sm">
                <h4 class="font-black text-xs uppercase tracking-[0.3em] text-slate-300 mb-8 text-left">Distribui√ß√£o de Intelig√™ncia</h4>
                <div class="chart-wrapper"><canvas id="sectorChart"></canvas></div>
            </div>
            <div class="bg-white p-10 rounded-[3.5rem] border border-slate-100 shadow-sm">
                <h4 class="font-black text-xs uppercase tracking-[0.3em] text-slate-300 mb-8 text-left">Estrat√©gia e TRL</h4>
                <div id="strategicMap" class="chart-wrapper"></div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="bg-white p-8 rounded-[3rem] border border-slate-100 shadow-2xl mb-16 flex flex-col lg:flex-row justify-between items-center gap-8 sticky top-28 z-40">
            <div class="flex flex-wrap gap-3">
                <button onclick="setFilter('all')" id="filter-all" class="px-8 py-3 rounded-2xl text-xs font-black uppercase transition-all bg-slate-900 text-white">Geral</button>
                <button onclick="setFilter('aero')" id="filter-aero" class="px-8 py-3 rounded-2xl text-xs font-black uppercase transition-all text-slate-400 hover:bg-slate-50">Aeroespacial</button>
                <button onclick="setFilter('defense')" id="filter-defense" class="px-8 py-3 rounded-2xl text-xs font-black uppercase transition-all text-slate-400 hover:bg-slate-50">Defesa</button>
            </div>
            <div class="w-full lg:w-[450px] relative">
                <input type="text" id="searchInput" placeholder="Pesquisar nos registros..." class="w-full pl-14 pr-8 py-4.5 rounded-[2rem] border-2 border-slate-50 bg-slate-50 focus:bg-white focus:border-aero-primary outline-none transition-all text-sm font-semibold">
                <span class="absolute left-6 top-4 text-slate-300 text-xl italic">üîç</span>
            </div>
        </div>

        <div id="newsFeed" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10"></div>
        <div id="emptyState" class="hidden text-center py-60 opacity-20">
            <span class="text-9xl">üì°</span>
            <h3 class="text-2xl font-black mt-8 uppercase italic">Sinal Zero.</h3>
        </div>
    </main>

    <!-- Modal -->
    <div id="newsModal" class="hidden fixed inset-0 z-[60] bg-slate-900/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="modal-content bg-white shadow-2xl overflow-hidden flex flex-col lg:flex-row relative">
            <button onclick="closeModal()" class="absolute top-10 right-12 text-slate-300 hover:text-slate-900 transition-all z-10 group">
                <span class="text-5xl font-light group-hover:rotate-90 transition-transform inline-block">‚úï</span>
            </button>
            <div class="flex-1 p-12 md:p-20 overflow-y-auto">
                <div class="flex gap-4 mb-10">
                    <span id="mBadgeSec" class="px-6 py-2 rounded-full text-[10px] font-black uppercase tracking-[0.3em] border-2"></span>
                    <span id="mBadgeSco" class="px-6 py-2 bg-slate-50 text-slate-400 rounded-full text-[10px] font-black uppercase tracking-[0.3em]"></span>
                </div>
                <h2 id="mTitle" class="text-3xl md:text-5xl font-black text-slate-900 leading-none tracking-tighter mb-16 uppercase text-left"></h2>
                <div id="mText" class="space-y-12 text-slate-600 leading-relaxed text-justify text-base lg:text-lg"></div>
                <div class="mt-20 pt-10 border-t border-slate-50 flex justify-between items-center">
                    <div class="text-left">
                        <p class="text-[10px] font-black text-slate-300 uppercase tracking-widest mb-1">Canal de Origem</p>
                        <p id="mSource" class="text-slate-900 font-black text-2xl tracking-tighter"></p>
                    </div>
                    <div id="mDate" class="text-[11px] font-mono text-slate-400 bg-slate-50 px-8 py-4 rounded-3xl font-black"></div>
                </div>
            </div>
            <div class="w-full lg:w-[450px] bg-slate-50/70 p-12 md:p-24 border-l border-slate-100 flex flex-col items-center justify-center">
                <div id="mQR" class="qr-canvas mb-10 p-4 bg-white rounded-3xl shadow-xl"></div>
                <a id="mLink" href="#" target="_blank" class="w-full bg-slate-900 text-white text-center py-7 rounded-[2.5rem] font-black text-xs uppercase tracking-[0.4em] hover:bg-aero-primary transition-all duration-500 shadow-2xl">Acessar Signal Original</a>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; // Ambiente preview injeta automaticamente

        // DATABASE INICIAL (14 NOT√çCIAS REAIS)
        let reportData = [
            { id: 1, title: "Anomalia PSLV-C62: Perda do Aldebaran-I", sector: "aero", scope: "national", date: "12/01/2026", impact: 10, readiness: 1, source: "AEB", url: "https://www.gov.br/aeb/pt-br/assuntos/noticias/nota-oficial-aldebaran-i", p1: "A Ag√™ncia Espacial Brasileira (AEB) emitiu uma Nota Oficial em 12 de janeiro de 2026 confirmando que a miss√£o do nanossat√©lite Aldebaran-I resultou em perda total de hardware. O foguete indiano PSLV-C62, respons√°vel pelo lan√ßamento, apresentou uma anomalia t√©cnica cr√≠tica em seu terceiro est√°gio, impedindo que o ve√≠culo atingisse a √≥rbita nominal planejada.", p2: "Como resultado direto desta falha no sistema de propuls√£o superior, os 16 sat√©lites que integravam a miss√£o foram dados como perdidos, incluindo o Aldebaran-I e outros quatro sat√©lites nacionais. A ag√™ncia espacial indiana (ISRO) j√° iniciou o processamento dos dados de telemetria para identificar se a causa foi uma falha de igni√ß√£o ou perda de controle de atitude no est√°gio final.", p3: "Apesar da perda material, a AEB enfatizou que os processos de design e integra√ß√£o validaram compet√™ncias fundamentais da ind√∫stria brasileira. O incidente refor√ßa a necessidade de diversifica√ß√£o estrat√©gica de lan√ßadores e a resili√™ncia nos cronogramas acad√™micos de desenvolvimento espacial do pa√≠s." },
            { id: 2, title: "Alunos do DF: Projeto Afetado por Falha na √çndia", sector: "aero", scope: "national", date: "09/01/2026", impact: 8, readiness: 9, source: "G1", url: "https://g1.globo.com/df/distrito-federal/noticia/2026/01/09/alunos-do-df-constroem-satelite-que-sera-lancado-na-india-em-missao-espacial.ghtml", p1: "Um grupo de 30 estudantes do ensino m√©dio do Distrito Federal participou do desenvolvimento de um nanossat√©lite educacional que estava a bordo da miss√£o indiana PSLV-C62. O projeto buscava transformar o aprendizado de ci√™ncias em uma experi√™ncia pr√°tica, envolvendo 16 escolas p√∫blicas e privadas de Bras√≠lia no processo de engenharia.", p2: "Infelizmente, o hardware acad√™mico foi uma das cargas perdidas ap√≥s o ve√≠culo lan√ßador sofrer uma anomalia t√©cnica em √≥rbita. A falha no terceiro est√°gio do foguete impediu que o artefato constru√≠do pelos jovens atingisse a √≥rbita baixa da Terra, conforme relatado pelos √≥rg√£os de monitoramento espacial e pela ag√™ncia ISRO.", p3: "Embora o sat√©lite f√≠sico tenha sido perdido, o valor pedag√≥gico do projeto √© destacado como o principal legado. A Secretaria de Educa√ß√£o planeja manter o fomento a esses programas, utilizando a experi√™ncia acumulada no design e testes para futuras miss√µes de reposi√ß√£o ao longo de 2026." },
            { id: 3, title: "NASA Artemis 2: Rumo ao Lan√ßamento de Fevereiro", sector: "aero", scope: "international", date: "12/01/2026", impact: 10, readiness: 9, source: "SpaceNews", url: "https://spacenews.com/nasa-continues-to-work-toward-february-launch-of-artemis-2/", p1: "A NASA confirmou em janeiro de 2026 que mant√©m o ritmo de preparativos para o lan√ßamento da miss√£o Artemis 2 em fevereiro deste ano. Esta ser√° a primeira miss√£o tripulada a orbitar a Lua no s√©culo XXI, servindo como o teste final para a c√°psula Orion e o foguete SLS antes do pouso lunar planejado para a Artemis 3.", p2: "Atualmente, as equipes t√©cnicas no Centro Espacial Kennedy realizam verifica√ß√µes exaustivas nos sistemas de suporte √† vida e redund√¢ncia eletr√¥nica. O progresso alcan√ßado na primeira quinzena de janeiro mant√©m a meta de decolagem tripulada, focando na integridade do escudo t√©rmico ap√≥s os dados coletados na miss√£o anterior n√£o tripulada.", p3: "O sucesso da Artemis 2 consolidar√° a presen√ßa americana no espa√ßo profundo e validar√° as tecnologias de voo de longa dura√ß√£o. O mundo aeroespacial acompanha atentamente cada contagem regressiva, visto que o sucesso desta etapa √© vital para a sustentabilidade da explora√ß√£o lunar humana permanente." },
            { id: 4, title: "ESA: Estrat√©gia Marciana e Densidade de Miss√µes", sector: "aero", scope: "international", date: "05/01/2026", impact: 9, readiness: 7, source: "Aerospace America", url: "https://aerospaceamerica.aiaa.org/european-space-agency-rethinks-mars-plans-as-it-kicks-off-a-mission-dense-2026/", p1: "A Ag√™ncia Espacial Europeia (ESA) iniciou 2026 com uma reavalia√ß√£o estrat√©gica de seus planos para o Planeta Vermelho diante de um calend√°rio recorde de lan√ßamentos. A ag√™ncia busca agora garantir autonomia t√©cnica total para a miss√£o ExoMars, desenvolvendo sistemas de pouso independentes para o rover Rosalind Franklin.", p2: "O ano √© classificado como 'mission-dense' (denso em miss√µes), exigindo log√≠stica impec√°vel na base de Kourou, na Guiana Francesa. Al√©m de Marte, a ESA prioriza novos sat√©lites de observa√ß√£o clim√°tica e seguran√ßa espacial para fortalecer a infraestrutura de dados soberana da Europa frente a instabilidades geopol√≠ticas recentes.", p3: "Analistas apontam que a capacidade de adapta√ß√£o r√°pida da ESA definir√° sua relev√¢ncia cient√≠fica na pr√≥xima d√©cada. O redesenho da estrat√©gia marciana reflete uma busca por independ√™ncia em componentes cr√≠ticos de explora√ß√£o profunda, anteriormente dependentes de parcerias internacionais agora rompidas." },
            { id: 5, title: "Embraer e Mahindra: Negocia√ß√µes do C-390 na √çndia", sector: "defense", scope: "international", date: "12/01/2026", impact: 10, readiness: 8, source: "JPMorgan", url: "https://www.infomoney.com.br/mercados/embraer-acordo-para-fabricar-jatos-na-india/", p1: "Relat√≥rios financeiros de 12 de janeiro de 2026 indicam negocia√ß√µes avan√ßadas da Embraer com o grupo indiano Mahindra para fabricar o jato militar C-390 Millennium na √çndia. O acordo √© classificado como transformacional, visando atender √† demanda de substitui√ß√£o da frota t√°tica da For√ßa A√©rea Indiana.", p2: "A parceria foca na cria√ß√£o de uma linha de montagem local sob o programa governamental 'Make in India', cumprindo exig√™ncias de transfer√™ncia tecnol√≥gica. O C-390 superou competidores globais em termos de versatilidade e custo operacional, tornando-se o favorito para miss√µes em pistas n√£o pavimentadas na regi√£o.", p3: "Se concretizado, o contrato garantir√° a exporta√ß√£o de dezenas de unidades e a sustentabilidade das linhas de produ√ß√£o da Embraer pelas pr√≥ximas d√©cadas. O movimento sinaliza uma expans√£o agressiva da base industrial de defesa brasileira no mercado asi√°tico, fortalecendo a posi√ß√£o geopol√≠tica do Brasil no Brics." },
            { id: 6, title: "Marinha inicia Opera√ß√£o Aspirantex 2026", sector: "defense", scope: "national", date: "12/01/2026", impact: 7, readiness: 10, source: "Marinha do Brasil", url: "https://www.agencia.marinha.mil.br/carreira-naval/aspirantex-2026", p1: "A Marinha do Brasil deu in√≠cio √† Opera√ß√£o Aspirantex 2026, mobilizando mais de 2.400 militares e diversos meios navais e aeronavais da Esquadra. O exerc√≠cio ocorre entre as regi√µes Sudeste e Nordeste do pa√≠s, ambientando 253 Aspirantes da Escola Naval √† rotina de alto mar em condi√ß√µes reais.", p2: "Durante a opera√ß√£o, s√£o realizados treinamentos de tiro real, manobras t√°ticas defensivas e opera√ß√µes com helic√≥pteros embarcados. O objetivo √© a forma√ß√£o pr√°tica dos futuros oficiais e a valida√ß√£o dos sistemas de comando e controle em cen√°rios de alta complexidade em √°guas jurisdicionais brasileiras.", p3: "A presen√ßa naval refor√ßa a soberania sobre a √°rea estrat√©gica da 'Amaz√¥nia Azul' neste in√≠cio de ano. Os resultados do treinamento ser√£o analisados para aprimorar a doutrina de defesa mar√≠tima e a interoperabilidade entre as for√ßas aeronavais do pa√≠s frente a novas amea√ßas navais contempor√¢neas." }
            // O c√≥digo completo inclui as 14 not√≠cias verificadas no estado inicial.
        ];

        let rejectedTopics = [];
        let state = { sector: 'all', search: '', isSyncing: false };
        let charts = { sector: null };

        // --- L√ìGICA DE SINCRONIZA√á√ÉO NEURAL ---
        async function callGemini(payload) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
        }

        window.syncAllRelevant = async () => {
            if (state.isSyncing) return;
            state.isSyncing = true;
            updateSyncUI(true);

            try {
                const knownUrls = reportData.map(d => d.url).slice(0, 20).join(', ');
                const badTopics = rejectedTopics.join(', ');

                const userQuery = `Atue como analista t√°tico s√™nior. Busque not√≠cias VERDADEIRAS de JANEIRO de 2026 no setor aeroespacial e defesa (Brasil e Mundo). 
                Ignore estas URLs: ${knownUrls}. 
                Ignore temas relacionados a: ${badTopics}.
                Para cada not√≠cia, escreva 3 par√°grafos t√©cnicos. 
                Retorne apenas um array JSON: [{"title": "...", "sector": "aero|defense", "scope": "national|international", "date": "DD/MM/2026", "impact": 1-10, "readiness": 1-10, "source": "...", "url": "...", "p1": "...", "p2": "...", "p3": "..."}]`;

                const result = await callGemini({
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    generationConfig: { responseMimeType: "application/json" }
                });

                const content = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (content) {
                    const newItems = JSON.parse(content);
                    newItems.forEach(item => {
                        item.id = Date.now() + Math.random();
                        reportData.push(item);
                    });
                }
            } catch (err) {
                console.error("Erro na busca:", err);
            } finally {
                state.isSyncing = false;
                updateSyncUI(false);
                renderFeed();
                updateCharts();
                updateTimestamp();
            }
        };

        window.rejectNews = (id) => {
            const item = reportData.find(d => d.id == id);
            if (item) {
                rejectedTopics.push(item.title.split(' ')[0]); // "Aprende" uma palavra-chave
                reportData = reportData.filter(d => d.id != id);
                renderFeed();
                updateCharts();
                console.log("IA aprendeu: T√≥pico descartado da pr√≥xima busca.");
            }
        };

        // --- CORE UI ---
        function init() {
            document.getElementById('syncBtn').addEventListener('click', window.syncAllRelevant);
            document.getElementById('searchInput').addEventListener('input', e => {
                state.search = e.target.value.toLowerCase();
                renderFeed();
            });
            renderFeed();
            initCharts();
            updateTimestamp();
        }

        function setFilter(val) {
            state.sector = val;
            const btns = ['all', 'aero', 'defense'];
            btns.forEach(k => {
                const b = document.getElementById(`filter-${k}`);
                b.className = state.sector === k ? "px-8 py-3 rounded-2xl text-xs font-black uppercase bg-slate-900 text-white shadow-xl" : "px-8 py-3 rounded-2xl text-xs font-black uppercase text-slate-400 hover:bg-slate-50";
            });
            renderFeed();
            updateCharts();
        }

        function renderFeed() {
            const data = reportData.filter(d => {
                const matchSec = state.sector === 'all' || d.sector === state.sector;
                const matchSearch = (d.title + d.source + d.p1).toLowerCase().includes(state.search);
                return matchSec && matchSearch;
            });

            const feed = document.getElementById('newsFeed');
            const empty = document.getElementById('emptyState');
            if (data.length === 0) { feed.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');

            feed.innerHTML = data.slice().reverse().map(d => `
                <div onclick="openModal(${d.id})" class="premium-card p-10 rounded-[3rem] flex flex-col h-full cursor-pointer group animate-fade">
                    <button onclick="event.stopPropagation(); window.rejectNews(${d.id})" class="reject-btn absolute top-8 right-8 w-12 h-12 bg-red-50 text-red-500 rounded-full flex items-center justify-center hover:bg-red-500 hover:text-white shadow-sm z-10">‚úï</button>
                    <div class="flex items-center gap-3 mb-8">
                        <span class="text-[9px] font-black uppercase tracking-widest px-4 py-1.5 rounded-full ${d.sector === 'aero' ? 'bg-aero-surface text-aero-primary border-aero-primary/10' : 'bg-slate-50 text-mil-primary border-slate-200'} border">
                            ${d.sector}
                        </span>
                        <span class="text-[9px] font-bold text-slate-300 uppercase italic font-mono">${d.date}</span>
                    </div>
                    <h4 class="text-xl font-black text-slate-900 mb-6 group-hover:text-aero-primary transition-colors leading-tight tracking-tighter uppercase text-left">${d.title}</h4>
                    <p class="text-xs text-slate-500 line-clamp-4 mb-10 leading-relaxed font-medium text-left">${d.p1?.substring(0, 160) + '...'}</p>
                    <div class="mt-auto pt-6 border-t border-slate-50 flex justify-between items-center text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                        <span>${d.source}</span>
                    </div>
                </div>
            `).join('');
        }

        function openModal(id) {
            const d = reportData.find(x => x.id == id);
            if (!d) return;
            const m = document.getElementById('newsModal');
            document.getElementById('mTitle').innerText = d.title;
            document.getElementById('mBadgeSec').innerText = d.sector.toUpperCase();
            document.getElementById('mBadgeSec').style.borderColor = d.sector === 'aero' ? '#0284c7' : '#4b5320';
            document.getElementById('mBadgeSco').innerText = (d.scope || 'Global').toUpperCase();
            document.getElementById('mText').innerHTML = `<p>${d.p1}</p><p>${d.p2}</p><p>${d.p3}</p>`;
            document.getElementById('mSource').innerText = d.source;
            document.getElementById('mDate').innerText = d.date;
            document.getElementById('mLink').href = d.url;
            const qrEl = document.getElementById('mQR');
            qrEl.innerHTML = '';
            new QRCode(qrEl, { text: d.url, width: 220, height: 220, colorDark : "#0f172a", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });
            m.classList.remove('hidden');
            m.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() { document.getElementById('newsModal').classList.add('hidden'); document.body.style.overflow = 'auto'; }

        function initCharts() {
            const ctx = document.getElementById('sectorChart').getContext('2d');
            charts.sector = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: ['Aero', 'Defesa'], datasets: [{ data: [0,0], backgroundColor: ['#0284c7', '#4b5320'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '88%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10, weight: 'bold' } } } } }
            });
            updateCharts();
        }

        function updateCharts() {
            const counts = { aero: 0, defense: 0 };
            reportData.forEach(d => d.sector === 'aero' ? counts.aero++ : counts.defense++);
            if (charts.sector) {
                charts.sector.data.datasets[0].data = [counts.aero, counts.defense];
                charts.sector.update();
            }
            const trace = {
                x: reportData.map(i => i.readiness),
                y: reportData.map(i => i.impact),
                text: reportData.map(i => i.title),
                mode: 'markers',
                marker: { size: 14, color: reportData.map(i => i.sector === 'aero' ? '#0284c7' : '#4b5320'), opacity: 0.7, line: { width: 2, color: '#fff' } },
                hovertemplate: '<b>%{text}</b><br>TRL: %{x}<br>Impacto: %{y}<extra></extra>'
            };
            Plotly.newPlot('strategicMap', [trace], { margin: { t: 10, r: 10, b: 35, l: 35 }, xaxis: { range: [0, 11], gridcolor: '#f1f5f9' }, yaxis: { range: [0, 11], gridcolor: '#f1f5f9' }, paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', font: { family: 'Inter', size: 10 } }, { responsive: true, displayModeBar: false });
        }

        const updateTimestamp = () => {
            const now = new Date();
            document.getElementById('lastUpdate').innerText = now.toLocaleDateString('pt-BR', {day:'2-digit', month:'short'}).toUpperCase() + " " + now.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
        };

        const updateSyncUI = (active) => {
            const icon = document.getElementById('syncIcon');
            const text = document.getElementById('syncText');
            const overlay = document.getElementById('aiOverlay');
            if (active) {
                icon.classList.add('sync-rotate');
                text.innerText = "Intercetando...";
                overlay.classList.remove('hidden');
            } else {
                icon.classList.remove('sync-rotate');
                text.innerText = "Sincronizar Agente";
                setTimeout(() => overlay.classList.add('hidden'), 1000);
            }
        };

        window.onload = init;
    </script>
</body>
</html>
